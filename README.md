# Vafast Benchmarks

Vafast 框架性能基准测试项目，对比主流 Node.js Web 框架与 Vafast 原生框架的性能表现。

## 📋 项目概述

本项目旨在通过严格的性能测试，验证 Vafast 框架在不同场景下的性能表现，并与主流框架进行对比分析。

### 🎯 测试目标

- **简单响应性能测试**: 对比基础路由响应性能
- **验证器性能测试**: 对比包含数据验证的复杂场景性能
- **内存使用分析**: 监控测试过程中的内存占用情况
- **单线程性能验证**: 确保框架在单线程环境下的优化效果

## 🚀 快速开始

### 环境要求

- Node.js 18+ 或 Bun 1.0+
- 支持 ES Modules

### 安装依赖

```bash
# 使用 npm
npm install

# 使用 yarn
yarn install

# 使用 bun
bun install
```

## 📊 性能测试

### 简单响应性能测试

运行简单响应性能测试：

```bash
bun run src/simple-response-benchmark.ts
```

**测试结果 (100,000 次迭代)**

| 框架 | 版本 | 请求/秒 | 平均耗时 | 总耗时 | 排名 | 相对性能 |
|------|------|----------|----------|--------|------|----------|
| vafast原生 (直接路由) | 0.1.2 | 826.64K (100%) | 1.21μs | 120.97ms | 🥇 第一 | 1.00x |
| 原生 Response | - | 784.94K (95.0%) | 1.27μs | 127.40ms | 🥈 第二 | 0.95x |
| vafast原生 (工厂路由) | 0.1.2 | 698.34K (84.5%) | 1.43μs | 143.20ms | 🥉 第三 | 0.84x |
| Koa | 3.0.1 | 434.56K (52.6%) | 2.30μs | 230.12ms | 4 | 0.53x |
| Elysia | 1.3.13 | 278.30K (33.7%) | 3.59μs | 359.32ms | 5 | 0.34x |
| Hono | 4.9.2 | 245.18K (29.7%) | 4.08μs | 407.86ms | 6 | 0.30x |
| Express | 5.1.0 | 239.01K (28.9%) | 4.18μs | 418.38ms | 7 | 0.29x |

### 验证器性能测试

运行验证器性能测试：

```bash
bun run src/validator-benchmark.ts
```

**测试结果 (100,000 次迭代，包含 TypeBox 验证器)**

| 框架 | 版本 | 请求/秒 | 平均耗时 | 总耗时 | 排名 | 相对性能 |
|------|------|----------|----------|--------|------|----------|
| vafast原生 (TypeBox验证器) | 0.1.2 | 318.14K (100%) | 3.14μs | 314.32ms | 🥇 第一 | 1.00x |
| Elysia (TypeBox验证器) | 1.3.13 | 255.53K (80.3%) | 3.91μs | 391.35ms | 🥈 第二 | 0.80x |
| Express (TypeBox验证器) | 5.1.0 | 251.13K (78.9%) | 3.98μs | 398.20ms | 🥉 第三 | 0.79x |
| Hono (TypeBox验证器) | 4.9.2 | 145.60K (45.8%) | 6.87μs | 686.80ms | 4 | 0.46x |
| Koa (TypeBox验证器) | 3.0.1 | 32.98K (10.4%) | 30.32μs | 3.03s | 5 | 0.10x |

## 🏆 性能分析

### 简单响应场景

- **原生 Response** 表现最佳，作为基准参考
- **Vafast 直接路由** 性能接近原生，仅损失 4.3%
- **Vafast 工厂路由** 在功能与性能间取得平衡
- 传统框架在简单场景下性能相对较低

### 验证器场景

- **Vafast 原生验证器** 性能领先，验证开销最小
- **Elysia** 验证器性能接近 Vafast，表现优秀
- **Hono** 验证器性能中等，适合中等复杂度项目
- **Express/Koa** 验证器性能较低，适合简单项目

## 💡 使用建议

### 性能优先场景

- **极简路由**: 使用 Vafast 直接路由获得最佳性能
- **简单验证**: 使用 Vafast 原生验证器平衡性能和功能

### 功能优先场景

- **复杂业务**: 使用完整验证获得全部功能
- **团队开发**: 选择熟悉的传统框架降低学习成本

## 🔧 项目结构

```
vafast-benchmarks/
├── src/
│   ├── config/                 # 测试配置文件
│   │   ├── simple-response-config.ts
│   │   └── validator-config.ts
│   ├── simple-response-benchmark.ts    # 简单响应测试
│   ├── validator-benchmark.ts          # 验证器测试
│   └── utils/                          # 工具函数
│       ├── benchmark-utils.ts
│       └── report-utils.ts
├── package.json
└── README.md
```

## 📈 测试环境

- **运行时**: Node.js 22.16.0
- **平台**: macOS (darwin arm64)
- **测试配置**: 100,000 次请求，5,000 次预热
- **内存监控**: 实时监控测试前后内存使用情况

## 📦 依赖版本

### 核心框架
- **vafast**: 0.1.2
- **elysia**: 1.3.13
- **hono**: 4.9.2
- **express**: 5.1.0
- **koa**: 3.0.1

### 验证器
- **@sinclair/typebox**: 0.32.0
- **@hono/typebox-validator**: 0.2.0
- **koa-bodyparser**: 4.4.1

### 开发工具
- **bun**: 1.2.20
- **@types/node**: 20.10.0
- **@types/express**: 4.17.21

### 环境要求
- **Node.js**: >=18.0.0
- **Bun**: >=1.0.0

## 🤝 贡献

欢迎提交 Issue 和 Pull Request 来改进测试用例和性能分析。

## 📄 许可证

本项目采用 MIT 许可证。