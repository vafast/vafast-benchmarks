# Vafast Benchmarks

Vafast 框架性能基准测试项目，对比主流 Node.js Web 框架与 Vafast 原生框架的性能表现。

## 📋 项目概述

本项目旨在通过严格的性能测试，验证 Vafast 框架在不同场景下的性能表现，并与主流框架进行对比分析。

### 🎯 测试目标

- **简单响应性能测试**: 对比基础路由响应性能
- **验证器性能测试**: 对比包含数据验证的复杂场景性能
- **内存使用分析**: 监控测试过程中的内存占用情况
- **单线程性能验证**: 确保框架在单线程环境下的优化效果

## 🚀 快速开始

### 环境要求

- Node.js 18+ 或 Bun 1.0+
- 支持 ES Modules

### 安装依赖

```bash
# 使用 npm
npm install

# 使用 yarn
yarn install

# 使用 bun
bun install
```

## 📊 性能测试

### 简单响应性能测试

运行简单响应性能测试：

```bash
bun run src/simple-response-benchmark.ts
```

**测试结果 (100,000 次迭代)**

| 框架 | 请求/秒 | 平均耗时 | 总耗时 | 排名 | 相对性能 |
|------|----------|----------|--------|------|----------|
| 原生 Response | 836.59K (100%) | 1.20μs | 119.53ms | 🥇 第一 | 1.00x |
| vafast原生 (直接路由) | 800.64K (95.7%) | 1.25μs | 124.90ms | 🥈 第二 | 0.96x |
| vafast原生 (工厂路由) | 674.90K (80.7%) | 1.48μs | 148.17ms | 🥉 第三 | 0.81x |
| Koa | 425.15K (50.8%) | 2.35μs | 235.21ms | 4 | 0.51x |
| Elysia | 324.44K (38.8%) | 3.08μs | 308.23ms | 5 | 0.39x |
| Express | 267.22K (31.9%) | 3.74μs | 374.23ms | 6 | 0.32x |
| Hono | 266.29K (31.8%) | 3.76μs | 375.54ms | 7 | 0.32x |

### 验证器性能测试

运行验证器性能测试：

```bash
bun run src/validator-benchmark.ts
```

**测试结果 (100,000 次迭代，包含 TypeBox 验证器)**

| 框架 | 请求/秒 | 平均耗时 | 总耗时 | 排名 | 相对性能 |
|------|----------|----------|--------|------|----------|
| vafast原生 (TypeBox验证器) | 311.90K (100%) | 3.21μs | 320.61ms | 🥇 第一 | 1.00x |
| Elysia (TypeBox验证器) | 296.05K (94.9%) | 3.38μs | 337.78ms | 🥈 第二 | 0.95x |
| Hono (TypeBox验证器) | 100.03K (32.1%) | 10.00μs | 999.73ms | 🥉 第三 | 0.32x |
| Express (TypeBox验证器) | 31.99K (10.3%) | 31.26μs | 3.13s | 4 | 0.10x |
| Koa (TypeBox验证器) | 31.49K (10.1%) | 31.76μs | 3.18s | 5 | 0.10x |

## 🏆 性能分析

### 简单响应场景

- **原生 Response** 表现最佳，作为基准参考
- **Vafast 直接路由** 性能接近原生，仅损失 4.3%
- **Vafast 工厂路由** 在功能与性能间取得平衡
- 传统框架在简单场景下性能相对较低

### 验证器场景

- **Vafast 原生验证器** 性能领先，验证开销最小
- **Elysia** 验证器性能接近 Vafast，表现优秀
- **Hono** 验证器性能中等，适合中等复杂度项目
- **Express/Koa** 验证器性能较低，适合简单项目

## 💡 使用建议

### 性能优先场景

- **极简路由**: 使用 Vafast 直接路由获得最佳性能
- **简单验证**: 使用 Vafast 原生验证器平衡性能和功能

### 功能优先场景

- **复杂业务**: 使用完整验证获得全部功能
- **团队开发**: 选择熟悉的传统框架降低学习成本

## 🔧 项目结构

```
vafast-benchmarks/
├── src/
│   ├── config/                 # 测试配置文件
│   │   ├── simple-response-config.ts
│   │   └── validator-config.ts
│   ├── simple-response-benchmark.ts    # 简单响应测试
│   ├── validator-benchmark.ts          # 验证器测试
│   └── utils/                          # 工具函数
│       ├── benchmark-utils.ts
│       └── report-utils.ts
├── package.json
└── README.md
```

## 📈 测试环境

- **运行时**: Node.js 24.3.0
- **平台**: macOS (darwin arm64)
- **测试配置**: 100,000 次请求，5,000 次预热
- **内存监控**: 实时监控测试前后内存使用情况

## 🤝 贡献

欢迎提交 Issue 和 Pull Request 来改进测试用例和性能分析。

## 📄 许可证

本项目采用 MIT 许可证。