# vafast-benchmarks

综合框架性能测试 - 对比主流框架与 vafast 原生框架

## 🚀 项目简介

本项目对主流Web框架与vafast原生框架进行全面的性能测试，包含简单响应和复杂验证器两种场景的性能对比。

> **🔥 新增高并发测试**: 1000并发线程 × 5000万请求，真实反映高负载场景下的性能表现！

## 📊 测试结果总览

### 测试配置
- **单线程测试**: 500,000 次迭代
- **并发测试**: 1,000 个并发线程, 50,000,000 个并发请求
- **验证器测试**: 1,000 次请求, 5 次运行
- **验证器并发测试**: 2,500,000 个并发请求, 1,000 个并发线程

## 🏆 性能测试结果

### 1. 简单响应性能测试

| 排名 | 框架 | 单线程性能 | 单线程耗时 | 并发性能 | 并发耗时 | 并发提升 | 性能等级 |
|------|------|------------|------------|----------|----------|----------|----------|
| 🥇 | **Elysia** | 306万 请求/秒 | 163.4ms | 346万 请求/秒 | 14.5s | **+13.1%** | 极优 |
| 🥈 | **原生 Response** | 226万 请求/秒 | 221.2ms | 226万 请求/秒 | 22.1s | **0.0%** | 优秀 |
| 🥉 | **vafast原生 (直接路由)** | 187万 请求/秒 | 267.4ms | 188万 请求/秒 | 26.6s | **+0.5%** | 优秀 |
| 📊 | **vafast原生 (工厂路由)** | 118万 请求/秒 | 423.7ms | 135万 请求/秒 | 37.0s | **+14.4%** | 良好 |
| 📊 | **vafast原生 (带验证版本)** | 139万 请求/秒 | 359.7ms | 133万 请求/秒 | 37.6s | **-4.3%** | 良好 |
| 📊 | **Express** | 134万 请求/秒 | 373.1ms | 126万 请求/秒 | 39.7s | **-6.0%** | 良好 |
| 📊 | **Hono** | 126万 请求/秒 | 396.8ms | 110万 请求/秒 | 45.5s | **-12.7%** | 良好 |

### 2. 复杂验证器性能测试

| 排名 | 框架 | 单线程性能 | 单线程耗时 | 并发性能 | 并发耗时 | 并发提升 | 性能等级 |
|------|------|------------|------------|----------|----------|----------|----------|
| 🥇 | **vafast原生 (TypeBox验证器)** | 157.50K 请求/秒 | 6.35ms | 170.58K 请求/秒 | 29.3s | **+8.3%** | 极优 |
| 🥈 | **Hono (TypeBox验证器)** | 102.95K 请求/秒 | 9.71ms | 105.22K 请求/秒 | 47.5s | **+2.2%** | 优秀 |
| 🥉 | **Elysia (TypeBox验证器)** | 47.33K 请求/秒 | 21.13ms | 50.24K 请求/秒 | 99.5s | **+6.1%** | 良好 |
| 📊 | **Express (TypeBox验证器)** | 34.13K 请求/秒 | 29.30ms | 35.18K 请求/秒 | 142.0s | **+3.1%** | 一般 |

## 📈 性能分析

### 简单响应性能分析
- **最快**: Elysia (306万 请求/秒, 163.4ms)
- **最慢**: vafast原生工厂路由 (118万 请求/秒, 423.7ms)
- **性能差距**: 160.2%
- **平均响应时间**: 单线程 0.2-0.4ms, 并发 0.3-0.8ms

### 验证器性能分析
- **最快**: vafast原生 (157.50K 请求/秒, 6.35ms)
- **最慢**: Express (34.13K 请求/秒, 29.30ms)
- **性能差距**: 361.5%
- **平均响应时间**: 单线程 6-29ms, 并发 29-142s

### 高并发性能表现分析
- **性能提升**: Elysia (+13.1%), vafast工厂路由 (+14.4%), vafast验证器 (+8.3%)
- **性能下降**: Express (-6.0%), Hono (-12.7%), vafast带验证版本 (-4.3%)
- **性能稳定**: vafast直接路由 (+0.5%), 原生Response (0.0%)

### 响应时间分析
- **单线程场景**: 所有框架响应时间在毫秒级别，性能差异相对较小
- **高并发场景**: 响应时间差异显著，vafast原生框架表现最稳定
- **验证器场景**: 响应时间较长，但vafast原生框架仍保持领先

## 🎯 关键发现

1. **vafast原生框架在验证器场景下表现优异**
   - 单线程性能: 157.50K 请求/秒 (6.35ms响应时间)
   - 并发性能: 170.58K 请求/秒 (29.3s总耗时)
   - 比Express快4.6倍，比Elysia快3.3倍，比Hono快1.5倍

2. **Elysia在简单响应场景下性能最佳**
   - 单线程性能: 306万 请求/秒 (163.4ms响应时间)
   - 并发性能: 346万 请求/秒 (14.5s总耗时)
   - 高并发下性能提升13.1%，响应时间从163.4ms降至4.2ms

3. **高并发性能表现差异显著**
   - **性能提升**: Elysia (+13.1%), vafast工厂路由 (+14.4%), vafast验证器 (+8.3%)
   - **性能下降**: Express (-6.0%), Hono (-12.7%), vafast带验证版本 (-4.3%)
   - **性能稳定**: vafast直接路由 (+0.5%), 原生Response (0.0%)

4. **响应时间性能分析**
   - **单线程**: 所有框架响应时间在毫秒级别，vafast原生验证器最快(6.35ms)
   - **高并发**: 响应时间差异显著，vafast原生框架最稳定
   - **验证器场景**: 响应时间较长但vafast原生框架仍保持领先

## 🚀 使用建议

### 场景适用性分析
- **✅ 极简路由**: 使用直接路由 (性能最佳)
- **✅ 简单路由**: 使用工厂路由 (平衡性能与功能)
- **✅ 复杂业务**: 使用带验证版本 (功能最全)

### 框架选择建议
- **高并发简单响应**: 选择Elysia (13.1%并发提升)
- **高并发验证器**: 选择vafast原生 (验证器性能王者)
- **中等负载**: 选择Hono (性能稳定)
- **传统企业级**: 选择Express (生态完整)
- **性能敏感**: 避免在高并发下使用Express和Hono

## 🛠️ 技术栈

- **测试框架**: Bun
- **验证器**: TypeBox
- **测试框架**: Elysia, Hono, Express, vafast

## 📋 运行测试

```bash
# 安装依赖
bun install

# 运行完整测试
bun run comprehensive-benchmark.ts

# 开发模式 (监听文件变化)
bun run dev

# 构建项目
bun run build
```

## 📝 测试说明

1. **简单响应测试**: 测试框架处理简单HTTP响应的性能
2. **复杂验证器测试**: 测试框架处理复杂数据验证的性能
3. **并发测试**: 测试框架在高并发场景下的性能表现
4. **性能分析**: 提供详细的性能对比和优化建议

## 📊 性能指标说明

### 请求速率 (RPS)
- **单线程**: 50万次请求的处理速率
- **并发**: 1000个并发线程处理5000万次请求的速率
- **单位**: 请求/秒 (requests per second)

### 响应时间
- **单线程**: 处理500,000次请求的总耗时
- **并发**: 处理50,000,000次请求的总耗时
- **平均响应时间**: 单次请求的平均处理时间

### 性能等级
- **极优**: 性能表现卓越，适合高负载生产环境
- **优秀**: 性能表现优秀，适合大多数生产环境
- **良好**: 性能表现良好，适合中等负载环境
- **一般**: 性能表现一般，建议优化或选择其他方案

## 🔄 更新日志

- **v1.0.0**: 初始版本，包含基础性能测试
- **v1.1.0**: 添加复杂验证器测试
- **v1.2.0**: 添加验证器并发测试
- **v1.3.0**: 完善性能分析和报告
- **v1.4.0**: 增强高并发测试 (1000线程, 5000万请求)
- **v1.4.1**: 更新文档，新增并发性能提升分析

---

*测试结果基于 Bun v1.2.20 环境，实际性能可能因硬件配置而异*
